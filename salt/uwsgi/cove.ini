[uwsgi]
socket = 127.0.0.1:{{ port }}
chdir = {{ djangodir }}
wsgi-file = cove/wsgi.py
virtualenv = .ve
uid = cove
gid = cove

{% if pillar.domain_prefix == 'staging.' %}
processes = 6
threads = 1
max-requests = 1024
memory-report = true
reload-on-rss = 100
{% else %}
processes = 1
threads = 10
{% endif %}

{% if port == 3031 %}
stats = 127.0.0.1:9191
{% endif %}
env = PIWIK_URL={{pillar.cove.piwik.url}}
env = PIWIK_SITE_ID={{pillar.cove.piwik.site_id}}
env = DEBUG=False
env = ALLOWED_HOSTS={{pillar.cove.allowedhosts}}
env = PREFIX_MAP={{pillar.cove.prefixmap}}
env = SENTRY_DSN={{pillar.cove.sentry_dsn}}
{% if 'google_analytics_id' in pillar.cove %}
env = GOOGLE_ANALYTICS_ID={{pillar.cove.google_analytics_id}}
{% endif %}
env = LANG=en_US.utf8
